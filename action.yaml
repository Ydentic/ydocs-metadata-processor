name: 'Ydentic metadata processor'
description: 'Ydentic metadata processor for adding the metadata header to .md files.'
inputs:
  github-author-name:
    description: 'Name of a service account in GitHub that does the autogenerated commits. This will show up as the author.'
    required: true
  github-author-email:
    description: 'Email address a service account in GitHub that does the autogenerated commits. This will show up as the author.'
    required: true
  github-token:
    description: 'Default GitHub token from the calling action.'
    required: true
  documentation-directory:
    description: 'Directory within the repository that contains the documentation.'
    required: false
runs:
  using: 'composite'
  steps:
    - name: 'Setup.Net 6.0'
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: '6.0'
    - name: 'Checkout the documentation'
      uses: actions/checkout@v3
      with:
        ref: ${{ github.ref-name }}
        path: ./documentation
        token: ${{ inputs.github-token }}
    - name: 'Checkout the builder'
      uses: actions/checkout@v3
      with:
        repository: ydentic/ydocs-metadata-processor
        ref: v1.0.2
        path: ./ydocs-metadata-processor
        token: ${{ inputs.github-token }} 
    - name: 'Add executable tag'
      run: chmod +x ./ydocs-metadata-processor/dist/YdocsMetadataProcessor.dll
      shell: bash
    - name: 'Run documentation builder'
      run: 'dotnet ./ydocs-metadata-processor/dist/YdocsMetadataProcessor.dll --repository ${{ github.repository }} --branch ${{ github.ref_name }} --folder ./documentation/${{ inputs.documenation-directory }}'
      shell: bash
    - name: Add & Commit
      uses: EndBug/add-and-commit@v9.0.1
      with:
        author_name: ${{ inputs.github-author-name }}
        author_email: ${{ inputs.github-author-email }}
        message: "Updated metadata"
        add: "*"
        cwd: "./documentation"
